syntax = "proto3";

package cornserve.task_dispatcher;

import "common.proto";

service TaskDispatcher {
  // New unit task deployed
  rpc NotifyUnitTaskDeployment(NotifyUnitTaskDeploymentRequest) returns (NotifyUnitTaskDeploymentResponse);

  // Existing unit task removed
  rpc NotifyUnitTaskTeardown(NotifyUnitTaskTeardownRequest) returns (NotifyUnitTaskTeardownResponse);

  // Sync task registry to a target resource version
  rpc SyncTaskRegistry(SyncTaskRegistryRequest) returns (SyncTaskRegistryResponse);
}

// New unit task deployed
message TaskManagerDeployment {
  // Task manager URL
  string url = 1;
}

message NotifyUnitTaskDeploymentRequest {
  // Name of the UnitTaskInstance CR that was deployed
  string task_instance_name = 1;

  // Task manager deployment info
  TaskManagerDeployment task_manager = 2;
}

message NotifyUnitTaskDeploymentResponse {
  common.Status status = 1;
}

// Existing unit task removed
message NotifyUnitTaskTeardownRequest {
  // Name of the UnitTaskInstance CR that was torn down
  string task_instance_name = 1;
}

message NotifyUnitTaskTeardownResponse {
  common.Status status = 1;
}

// Sync task registry to a target resource version
message SyncTaskRegistryRequest {
  // Target resource version to sync to
  int64 target_rv = 1;
}

message SyncTaskRegistryResponse {
  // Success or failure
  common.Status status = 1;
}
